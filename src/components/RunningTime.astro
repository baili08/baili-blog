---
interface Props {
	startDate: Date;
}
---

<div id="running-time-component" data-start-date="{Astro.props.startDate.toISOString()}">
  â±ï¸è¿è¡Œæ—¶é—´è®¡ç®—ä¸­...
</div>

<script>
  // è·å–ç»„ä»¶å…ƒç´ å’Œå¼€å§‹æ—¥æœŸ
  const component = document.getElementById('running-time-component');
  const startDateString = component?.dataset.startDate;
  const startDate = startDateString ? new Date(startDateString) : new Date();
  
  // æ ¼å¼åŒ–æ—¶é—´å‡½æ•°
  function formatTime(seconds: number): string {
    const d = Math.floor(seconds / 86400);
    const h = Math.floor((seconds % 86400) / 3600);
    const m = Math.floor((seconds % 3600) / 60);
    const s = seconds % 60;
    return `${d}å¤©${h}å°æ—¶${m}åˆ†${s}ç§’`;
  }
  
  let interval: ReturnType<typeof setInterval> | null = null;
  
  function update() {
    const now = new Date();
    // startDate ä» data å±æ€§è·å–
    const diff = Math.floor((now.getTime() - startDate.getTime()) / 1000);
    
    const formattedTime = diff < 0
      ? `ğŸ”œ ç«™ç‚¹å³å°†ä¸Šçº¿ï¼šå€’è®¡æ—¶ ${formatTime(-diff)}`
      : `â±ï¸æœ¬ç«™å·²è¿è¡Œ: ${formatTime(diff)} â˜ï¸`;
    
    // æ›´æ–°æ˜¾ç¤º
    if (component) {
      component.textContent = formattedTime;
    }
  }
  
  // ç«‹å³æ‰§è¡Œä¸€æ¬¡
  update();
  
  // è®¾ç½®å®šæ—¶å™¨æ¯ç§’æ›´æ–°
  interval = setInterval(update, 1000);
  
  // é¡µé¢å¸è½½æ—¶æ¸…ç†å®šæ—¶å™¨
  window.addEventListener('beforeunload', () => {
    if (interval) {
      clearInterval(interval);
      interval = null;
    }
  });
</script>