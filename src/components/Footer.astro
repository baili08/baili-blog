---
import { profileConfig } from "../config";
import { url } from "../utils/url-utils";

const currentYear = new Date().getFullYear();
---

<!-- åˆ†éš”çº¿ -->
<div class="transition border-t border-black/10 dark:border-white/15 my-10 border-dashed mx-32"></div>

<!-- footer å†…å®¹ -->
<footer class="transition border-dashed border-[oklch(85%_0.01_var(--hue))] dark:border-white/15 rounded-2xl mb-12 flex flex-col items-center justify-center px-6 bg-[var(--page-bg)]">
    <!-- ç«™ç‚¹ç»Ÿè®¡ -->
    <div class="framework-info text-sm text-center text-black/75 dark:text-white/75">
        <!-- ä¸è’œå­ç»Ÿè®¡ -->
        <script is:inline src="https://www.busuanzi.cc/static/3.6.9/busuanzi.min.js" defer></script>

        <span>
            æœ¬"<span class="text-[var(--primary)] font-bold">é¡µé¢</span>"é˜…è¯»
            <span id="busuanzi_page_pv" class="text-[var(--primary)] font-bold">åŠ è½½ä¸­...</span> æ¬¡ |
            ğŸ‘€æ€»è®¿é—®
            <span id="busuanzi_site_pv" class="text-[var(--primary)] font-bold">åŠ è½½ä¸­...</span> æ¬¡ |
            æ€»è®¿å®¢
            <span id="busuanzi_site_uv" class="text-[var(--primary)] font-bold">åŠ è½½ä¸­...</span> äºº
        </span>
        <br>

        <!-- ICP å¤‡æ¡ˆå· -->
        <a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer"
           class="text-[var(--primary)] font-bold">
            æ™‹ICPå¤‡2025063045å·
        </a>
        <br>

        <!-- è¿è¡Œæ—¶é—´æ˜¾ç¤ºå®¹å™¨ -->
        <div id="running-time-display-container">
            <span id="running-time-display">â±ï¸è¿è¡Œæ—¶é—´è®¡ç®—ä¸­...</span>
        </div>
        
        <!-- éšè—çš„è°ƒè¯•ä¿¡æ¯ -->
        <div id="debug-info" style="display: none;">
            <span id="debug-browser-info"></span>
            <span id="debug-init-status"></span>
            <span id="debug-attempts"></span>
        </div>
    </div>

    <!-- ç‰ˆæƒ & é“¾æ¥ -->
    <div class="transition text-50 text-sm text-center mt-3 text-black/50 dark:text-white/50">
        &copy; <span id="copyright-year">{currentYear}</span> {profileConfig.name}. All Rights Reserved. /
        <a class="transition link text-[var(--primary)] font-medium" target="_blank" href={url('rss.xml')}>RSS</a> /
        <a class="transition link text-[var(--primary)] font-medium" target="_blank" href={url('sitemap-index.xml')}>Sitemap</a><br>
        Powered by
        <a class="transition link text-[var(--primary)] font-medium" target="_blank" href="https://astro.build">Astro</a> &
        <a class="transition link text-[var(--primary)] font-medium" target="_blank" href="https://github.com/saicaca/fuwari">Fuwari</a>
    </div>
</footer>

<!-- è¿è¡Œæ—¶é—´è®¡ç®—ä¸æ˜¾ç¤ºç³»ç»Ÿ -->
<script is:inline>
    /**
     * ç«™ç‚¹è¿è¡Œæ—¶é—´è®¡ç®—ä¸æ˜¾ç¤ºç³»ç»Ÿ
     * 
     * è¯¥ç³»ç»Ÿé‡‡ç”¨å¤šå±‚ä¿éšœæœºåˆ¶ç¡®ä¿åœ¨å„ç§è®¾å¤‡å’Œæµè§ˆå™¨ç¯å¢ƒä¸‹éƒ½èƒ½æ­£ç¡®æ˜¾ç¤ºç«™ç‚¹è¿è¡Œæ—¶é—´
     * åŒ…æ‹¬DOMå°±ç»ªæ£€æµ‹ã€æµè§ˆå™¨å…¼å®¹æ€§å¤„ç†ã€ç§»åŠ¨ç«¯ç‰¹æ®Šå¤„ç†ç­‰
     */
    
    // ç³»ç»Ÿé…ç½®
    const RUNTIME_CONFIG = {
        // å»ºç«™æ—¥æœŸ (2025å¹´7æœˆ22æ—¥ 8:00:00)
        startDate: new Date(2025, 6, 22, 8, 0, 0),
        // æ›´æ–°é—´éš” (æ¯«ç§’)
        updateInterval: 1000,
        // åˆå§‹åŒ–å°è¯•é—´éš” (æ¯«ç§’)
        initIntervals: [10, 50, 100, 250, 500, 1000, 2000, 3000, 5000],
        // æœ€å¤§åˆå§‹åŒ–å°è¯•æ¬¡æ•°
        maxInitAttempts: 20,
        // è°ƒè¯•æ¨¡å¼
        debugMode: false
    };
    
    // ç³»ç»ŸçŠ¶æ€ç®¡ç†
    const RuntimeSystemState = {
        // åˆå§‹åŒ–çŠ¶æ€
        initialized: false,
        // åˆå§‹åŒ–å°è¯•æ¬¡æ•°
        initAttempts: 0,
        // å®šæ—¶å™¨ID
        intervalId: null,
        // æµè§ˆå™¨ä¿¡æ¯
        browserInfo: {
            isMobile: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),
            isIOS: /iPad|iPhone|iPod/.test(navigator.userAgent),
            isSafari: /^((?!chrome|android).)*safari/i.test(navigator.userAgent),
            userAgent: navigator.userAgent
        },
        // è°ƒè¯•ä¿¡æ¯
        debugInfo: {
            initEvents: [],
            errorMessages: [],
            successMessages: []
        }
    };
    
    /**
     * å·¥å…·å‡½æ•°é›†åˆ
     */
    const RuntimeUtils = {
        /**
         * æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
         * @param {number} seconds - æ€»ç§’æ•°
         * @returns {string} æ ¼å¼åŒ–åçš„æ—¶é—´å­—ç¬¦ä¸²
         */
        formatTime(seconds) {
            if (seconds < 0) return "â±ï¸è¿è¡Œæ—¶é—´è®¡ç®—ä¸­...";
            
            const days = Math.floor(seconds / 86400);
            const hours = Math.floor((seconds % 86400) / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            
            return `â±ï¸æœ¬ç«™å·²è¿è¡Œ: ${days}å¤©${hours}å°æ—¶${minutes}åˆ†${secs}ç§’ â˜ï¸`;
        },
        
        /**
         * è·å–DOMå…ƒç´ 
         * @param {string} id - å…ƒç´ ID
         * @returns {HTMLElement|null} DOMå…ƒç´ æˆ–null
         */
        getElement(id) {
            try {
                return document.getElementById(id);
            } catch (error) {
                this.logError(`è·å–å…ƒç´ å¤±è´¥: ${id}`, error);
                return null;
            }
        },
        
        /**
         * è®°å½•è°ƒè¯•ä¿¡æ¯
         * @param {string} message - è°ƒè¯•ä¿¡æ¯
         * @param {string} type - ä¿¡æ¯ç±»å‹ (info/warn/error)
         */
        logDebug(message, type = "info") {
            if (!RUNTIME_CONFIG.debugMode) return;
            
            const timestamp = new Date().toISOString();
            const logMessage = `[RuntimeSystem][${timestamp}] ${message}`;
            
            switch (type) {
                case "warn":
                    console.warn(logMessage);
                    break;
                case "error":
                    console.error(logMessage);
                    break;
                default:
                    console.log(logMessage);
            }
            
            // è®°å½•åˆ°ç³»ç»ŸçŠ¶æ€
            RuntimeSystemState.debugInfo[`${type}Messages`].push(logMessage);
            
            // æ›´æ–°è°ƒè¯•æ˜¾ç¤º
            this.updateDebugDisplay();
        },
        
        /**
         * è®°å½•é”™è¯¯ä¿¡æ¯
         * @param {string} message - é”™è¯¯ä¿¡æ¯
         * @param {Error} error - é”™è¯¯å¯¹è±¡
         */
        logError(message, error = null) {
            const errorMessage = error ? `${message} - ${error.message}` : message;
            this.logDebug(errorMessage, "error");
        },
        
        /**
         * æ›´æ–°è°ƒè¯•æ˜¾ç¤º
         */
        updateDebugDisplay() {
            if (!RUNTIME_CONFIG.debugMode) return;
            
            const debugInfoElement = this.getElement("debug-info");
            if (!debugInfoElement) return;
            
            const browserInfoElement = this.getElement("debug-browser-info");
            const initStatusElement = this.getElement("debug-init-status");
            const attemptsElement = this.getElement("debug-attempts");
            
            if (browserInfoElement) {
                browserInfoElement.textContent = `Browser: ${RuntimeSystemState.browserInfo.userAgent.substring(0, 50)}...`;
            }
            
            if (initStatusElement) {
                initStatusElement.textContent = `Initialized: ${RuntimeSystemState.initialized}`;
            }
            
            if (attemptsElement) {
                attemptsElement.textContent = `Attempts: ${RuntimeSystemState.initAttempts}`;
            }
            
            debugInfoElement.style.display = "block";
        },
        
        /**
         * æ£€æŸ¥å¿…è¦å…ƒç´ æ˜¯å¦å­˜åœ¨
         * @returns {boolean} æ˜¯å¦å­˜åœ¨å¿…è¦å…ƒç´ 
         */
        checkRequiredElements() {
            const requiredElements = [
                "running-time-display",
                "running-time-display-container"
            ];
            
            for (const elementId of requiredElements) {
                if (!this.getElement(elementId)) {
                    this.logError(`ç¼ºå°‘å¿…è¦å…ƒç´ : ${elementId}`);
                    return false;
                }
            }
            
            return true;
        },
        
        /**
         * æ£€æŸ¥DOMæ˜¯å¦å°±ç»ª
         * @returns {boolean} DOMæ˜¯å¦å°±ç»ª
         */
        isDOMReady() {
            return document.readyState === "complete" || document.readyState === "interactive";
        }
    };
    
    /**
     * è¿è¡Œæ—¶é—´è®¡ç®—æ ¸å¿ƒç±»
     */
    class RuntimeCalculator {
        /**
         * è®¡ç®—è¿è¡Œæ—¶é—´
         * @returns {string} æ ¼å¼åŒ–åçš„è¿è¡Œæ—¶é—´å­—ç¬¦ä¸²
         */
        static calculate() {
            try {
                const now = new Date();
                const diff = now - RUNTIME_CONFIG.startDate;
                const seconds = Math.floor(diff / 1000);
                
                return RuntimeUtils.formatTime(seconds);
            } catch (error) {
                RuntimeUtils.logError("è®¡ç®—è¿è¡Œæ—¶é—´å¤±è´¥", error);
                return "â±ï¸è¿è¡Œæ—¶é—´è®¡ç®—ä¸­...";
            }
        }
        
        /**
         * æ›´æ–°æ˜¾ç¤º
         */
        static updateDisplay() {
            try {
                const displayElement = RuntimeUtils.getElement("running-time-display");
                if (!displayElement) {
                    RuntimeUtils.logError("æ— æ³•æ‰¾åˆ°æ˜¾ç¤ºå…ƒç´ ");
                    return;
                }
                
                const timeString = this.calculate();
                displayElement.textContent = timeString;
                
                RuntimeUtils.logDebug(`æ›´æ–°æ˜¾ç¤º: ${timeString}`);
            } catch (error) {
                RuntimeUtils.logError("æ›´æ–°æ˜¾ç¤ºå¤±è´¥", error);
            }
        }
    }
    
    /**
     * åˆå§‹åŒ–ç®¡ç†å™¨
     */
    class InitializationManager {
        /**
         * æ‰§è¡Œåˆå§‹åŒ–
         * @returns {boolean} æ˜¯å¦åˆå§‹åŒ–æˆåŠŸ
         */
        static initialize() {
            // é˜²æ­¢é‡å¤åˆå§‹åŒ–
            if (RuntimeSystemState.initialized) {
                RuntimeUtils.logDebug("ç³»ç»Ÿå·²åˆå§‹åŒ–ï¼Œè·³è¿‡é‡å¤åˆå§‹åŒ–");
                return true;
            }
            
            // å¢åŠ å°è¯•æ¬¡æ•°
            RuntimeSystemState.initAttempts++;
            RuntimeUtils.logDebug(`åˆå§‹åŒ–å°è¯• #${RuntimeSystemState.initAttempts}`);
            
            // æ£€æŸ¥å¿…è¦å…ƒç´ 
            if (!RuntimeUtils.checkRequiredElements()) {
                RuntimeUtils.logError("å¿…è¦å…ƒç´ æ£€æŸ¥å¤±è´¥");
                return false;
            }
            
            try {
                // é¦–æ¬¡æ›´æ–°æ˜¾ç¤º
                RuntimeCalculator.updateDisplay();
                
                // æ¸…é™¤å·²å­˜åœ¨çš„å®šæ—¶å™¨
                if (RuntimeSystemState.intervalId) {
                    clearInterval(RuntimeSystemState.intervalId);
                }
                
                // è®¾ç½®å®šæ—¶æ›´æ–°
                RuntimeSystemState.intervalId = setInterval(() => {
                    RuntimeCalculator.updateDisplay();
                }, RUNTIME_CONFIG.updateInterval);
                
                // æ ‡è®°ä¸ºå·²åˆå§‹åŒ–
                RuntimeSystemState.initialized = true;
                
                RuntimeUtils.logDebug("åˆå§‹åŒ–æˆåŠŸ");
                RuntimeUtils.updateDebugDisplay();
                
                return true;
            } catch (error) {
                RuntimeUtils.logError("åˆå§‹åŒ–è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯", error);
                return false;
            }
        }
        
        /**
         * å»¶è¿Ÿåˆå§‹åŒ–
         * @param {number} delay - å»¶è¿Ÿæ—¶é—´(æ¯«ç§’)
         */
        static delayedInitialize(delay) {
            RuntimeUtils.logDebug(`è®¡åˆ’å»¶è¿Ÿåˆå§‹åŒ–: ${delay}ms`);
            
            setTimeout(() => {
                if (!RuntimeSystemState.initialized) {
                    this.initialize();
                }
            }, delay);
        }
        
        /**
         * å¯åŠ¨åˆå§‹åŒ–åºåˆ—
         */
        static startInitializationSequence() {
            RuntimeUtils.logDebug("å¯åŠ¨åˆå§‹åŒ–åºåˆ—");
            
            // ç«‹å³å°è¯•åˆå§‹åŒ–
            if (RuntimeUtils.isDOMReady()) {
                this.initialize();
            }
            
            // æŒ‰é…ç½®çš„æ—¶é—´é—´éš”ä¾æ¬¡å°è¯•åˆå§‹åŒ–
            RUNTIME_CONFIG.initIntervals.forEach((delay, index) => {
                this.delayedInitialize(delay);
            });
            
            // é¢å¤–çš„å»¶è¿Ÿå°è¯•ï¼Œç¡®ä¿åœ¨æç«¯æƒ…å†µä¸‹ä¹Ÿèƒ½åˆå§‹åŒ–
            for (let i = 1; i <= 5; i++) {
                this.delayedInitialize(i * 10000); // 10ç§’ã€20ç§’ã€30ç§’ã€40ç§’ã€50ç§’
            }
        }
    }
    
    /**
     * äº‹ä»¶ç›‘å¬å™¨ç®¡ç†å™¨
     */
    class EventListenerManager {
        /**
         * æ·»åŠ DOMå°±ç»ªäº‹ä»¶ç›‘å¬å™¨
         */
        static addDOMReadyListener() {
            const handleDOMReady = () => {
                RuntimeUtils.logDebug("DOMå°±ç»ªäº‹ä»¶è§¦å‘");
                InitializationManager.initialize();
            };
            
            if (document.readyState === "loading") {
                document.addEventListener("DOMContentLoaded", handleDOMReady);
                RuntimeUtils.logDebug("æ·»åŠ DOMContentLoadedäº‹ä»¶ç›‘å¬å™¨");
            } else {
                // DOMå·²ç»å°±ç»ª
                handleDOMReady();
            }
        }
        
        /**
         * æ·»åŠ é¡µé¢åŠ è½½å®Œæˆäº‹ä»¶ç›‘å¬å™¨
         */
        static addLoadListener() {
            const handleLoad = () => {
                RuntimeUtils.logDebug("é¡µé¢åŠ è½½å®Œæˆäº‹ä»¶è§¦å‘");
                InitializationManager.initialize();
            };
            
            if (document.readyState === "complete") {
                // é¡µé¢å·²ç»åŠ è½½å®Œæˆ
                handleLoad();
            } else {
                window.addEventListener("load", handleLoad);
                RuntimeUtils.logDebug("æ·»åŠ loadäº‹ä»¶ç›‘å¬å™¨");
            }
        }
        
        /**
         * æ·»åŠ é¡µé¢å¯è§æ€§å˜åŒ–äº‹ä»¶ç›‘å¬å™¨
         */
        static addVisibilityChangeListener() {
            const handleVisibilityChange = () => {
                RuntimeUtils.logDebug(`é¡µé¢å¯è§æ€§å˜åŒ–: ${document.hidden ? 'éšè—' : 'æ˜¾ç¤º'}`);
                if (!document.hidden) {
                    InitializationManager.initialize();
                }
            };
            
            document.addEventListener("visibilitychange", handleVisibilityChange);
            RuntimeUtils.logDebug("æ·»åŠ visibilitychangeäº‹ä»¶ç›‘å¬å™¨");
        }
        
        /**
         * æ·»åŠ é¡µé¢æ˜¾ç¤º/éšè—äº‹ä»¶ç›‘å¬å™¨ (ç§»åŠ¨ç«¯ç‰¹æ®Šå¤„ç†)
         */
        static addPageLifecycleListeners() {
            const handlePageShow = () => {
                RuntimeUtils.logDebug("é¡µé¢æ˜¾ç¤ºäº‹ä»¶è§¦å‘");
                InitializationManager.initialize();
            };
            
            const handlePageHide = () => {
                RuntimeUtils.logDebug("é¡µé¢éšè—äº‹ä»¶è§¦å‘");
                // é¡µé¢éšè—æ—¶æ¸…é™¤å®šæ—¶å™¨ä»¥èŠ‚çœèµ„æº
                if (RuntimeSystemState.intervalId) {
                    clearInterval(RuntimeSystemState.intervalId);
                    RuntimeSystemState.intervalId = null;
                    RuntimeUtils.logDebug("æ¸…é™¤å®šæ—¶å™¨");
                }
            };
            
            window.addEventListener("pageshow", handlePageShow);
            window.addEventListener("pagehide", handlePageHide);
            
            RuntimeUtils.logDebug("æ·»åŠ pageshowå’Œpagehideäº‹ä»¶ç›‘å¬å™¨");
        }
        
        /**
         * æ·»åŠ å°±ç»ªçŠ¶æ€å˜åŒ–äº‹ä»¶ç›‘å¬å™¨
         */
        static addReadyStateChangeListener() {
            const handleReadyStateChange = () => {
                RuntimeUtils.logDebug(`å°±ç»ªçŠ¶æ€å˜åŒ–: ${document.readyState}`);
                if (document.readyState === "interactive" || document.readyState === "complete") {
                    InitializationManager.initialize();
                }
            };
            
            document.addEventListener("readystatechange", handleReadyStateChange);
            RuntimeUtils.logDebug("æ·»åŠ readystatechangeäº‹ä»¶ç›‘å¬å™¨");
        }
        
        /**
         * åˆå§‹åŒ–æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨
         */
        static initializeAllListeners() {
            try {
                this.addDOMReadyListener();
                this.addLoadListener();
                this.addVisibilityChangeListener();
                this.addPageLifecycleListeners();
                this.addReadyStateChangeListener();
                
                RuntimeUtils.logDebug("æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨åˆå§‹åŒ–å®Œæˆ");
            } catch (error) {
                RuntimeUtils.logError("åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨å¤±è´¥", error);
            }
        }
    }
    
    /**
     * ç§»åŠ¨ç«¯ç‰¹æ®Šå¤„ç†ç®¡ç†å™¨
     */
    class MobileSpecialHandler {
        /**
         * æ£€æŸ¥æ˜¯å¦ä¸ºç§»åŠ¨ç«¯æµè§ˆå™¨
         * @returns {boolean} æ˜¯å¦ä¸ºç§»åŠ¨ç«¯
         */
        static isMobileBrowser() {
            return RuntimeSystemState.browserInfo.isMobile;
        }
        
        /**
         * æ£€æŸ¥æ˜¯å¦ä¸ºiOSè®¾å¤‡
         * @returns {boolean} æ˜¯å¦ä¸ºiOSè®¾å¤‡
         */
        static isIOSDevice() {
            return RuntimeSystemState.browserInfo.isIOS;
        }
        
        /**
         * åº”ç”¨ç§»åŠ¨ç«¯ç‰¹æ®Šå¤„ç†
         */
        static applySpecialHandling() {
            if (!this.isMobileBrowser()) {
                RuntimeUtils.logDebug("éç§»åŠ¨ç«¯æµè§ˆå™¨ï¼Œè·³è¿‡ç‰¹æ®Šå¤„ç†");
                return;
            }
            
            RuntimeUtils.logDebug("æ£€æµ‹åˆ°ç§»åŠ¨ç«¯æµè§ˆå™¨ï¼Œåº”ç”¨ç‰¹æ®Šå¤„ç†");
            
            // æ·»åŠ é¢å¤–çš„å»¶è¿Ÿåˆå§‹åŒ–
            const mobileDelays = [100, 500, 1000, 2000, 3000, 5000, 10000];
            mobileDelays.forEach(delay => {
                InitializationManager.delayedInitialize(delay);
            });
            
            // iOSç‰¹æ®Šå¤„ç†
            if (this.isIOSDevice()) {
                RuntimeUtils.logDebug("æ£€æµ‹åˆ°iOSè®¾å¤‡ï¼Œåº”ç”¨iOSç‰¹æ®Šå¤„ç†");
                
                // æ·»åŠ æ›´é•¿çš„å»¶è¿Ÿåˆå§‹åŒ–
                const iosDelays = [15000, 30000, 60000]; // 15ç§’ã€30ç§’ã€1åˆ†é’Ÿ
                iosDelays.forEach(delay => {
                    InitializationManager.delayedInitialize(delay);
                });
            }
        }
    }
    
    /**
     * ç³»ç»Ÿä¸»æ§åˆ¶å™¨
     */
    class RuntimeSystemController {
        /**
         * åˆå§‹åŒ–ç³»ç»Ÿ
         */
        static initializeSystem() {
            RuntimeUtils.logDebug("å¼€å§‹åˆå§‹åŒ–è¿è¡Œæ—¶é—´ç³»ç»Ÿ");
            
            try {
                // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬å™¨
                EventListenerManager.initializeAllListeners();
                
                // åº”ç”¨ç§»åŠ¨ç«¯ç‰¹æ®Šå¤„ç†
                MobileSpecialHandler.applySpecialHandling();
                
                // å¯åŠ¨åˆå§‹åŒ–åºåˆ—
                InitializationManager.startInitializationSequence();
                
                // æ·»åŠ æœ€ç»ˆä¿éšœ
                setTimeout(() => {
                    if (!RuntimeSystemState.initialized) {
                        RuntimeUtils.logDebug("æœ€ç»ˆä¿éšœåˆå§‹åŒ–");
                        InitializationManager.initialize();
                    }
                }, 60000); // 1åˆ†é’Ÿåæœ€ç»ˆä¿éšœ
                
                RuntimeUtils.logDebug("è¿è¡Œæ—¶é—´ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ");
            } catch (error) {
                RuntimeUtils.logError("ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥", error);
            }
        }
    }
    
    /**
     * å¯åŠ¨ç³»ç»Ÿ
     */
    function startRuntimeSystem() {
        // ç¡®ä¿åªå¯åŠ¨ä¸€æ¬¡
        if (window.runtimeSystemStarted) {
            RuntimeUtils.logDebug("ç³»ç»Ÿå·²å¯åŠ¨ï¼Œè·³è¿‡é‡å¤å¯åŠ¨");
            return;
        }
        
        window.runtimeSystemStarted = true;
        RuntimeUtils.logDebug("å¯åŠ¨è¿è¡Œæ—¶é—´ç³»ç»Ÿ");
        
        // å»¶è¿Ÿå¯åŠ¨ä»¥ç¡®ä¿æ‰€æœ‰èµ„æºåŠ è½½å®Œæˆ
        setTimeout(() => {
            RuntimeSystemController.initializeSystem();
        }, 10);
    }
    
    // å¯åŠ¨ç³»ç»Ÿ
    if (typeof window !== 'undefined') {
        // DOMå°±ç»ªæ—¶å¯åŠ¨
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', startRuntimeSystem);
        } else {
            // DOMå·²ç»å°±ç»ª
            startRuntimeSystem();
        }
        
        // é¡µé¢åŠ è½½å®Œæˆæ—¶å¯åŠ¨
        window.addEventListener('load', startRuntimeSystem);
        
        // å°±ç»ªçŠ¶æ€å˜åŒ–æ—¶å¯åŠ¨
        document.addEventListener('readystatechange', () => {
            if (document.readyState === 'interactive' || document.readyState === 'complete') {
                startRuntimeSystem();
            }
        });
    }
</script>