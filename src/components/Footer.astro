---
import { profileConfig } from "../config";
import { url } from "../utils/url-utils";

const currentYear = new Date().getFullYear();
---

<!-- åˆ†éš”çº¿ -->
<div class="transition border-t border-black/10 dark:border-white/15 my-10 border-dashed mx-32"></div>

<!-- footer å†…å®¹ -->
<footer class="transition border-dashed border-[oklch(85%_0.01_var(--hue))] dark:border-white/15 rounded-2xl mb-12 flex flex-col items-center justify-center px-6 bg-[var(--page-bg)]">
    <!-- ç«™ç‚¹ç»Ÿè®¡ -->
    <div class="framework-info text-sm text-center text-black/75 dark:text-white/75">
        <!-- ä¸è’œå­ç»Ÿè®¡ -->
        <script is:inline src="https://www.busuanzi.cc/static/3.6.9/busuanzi.min.js" defer></script>

        <span>
            æœ¬"<span class="text-[var(--primary)] font-bold">é¡µé¢</span>"é˜…è¯»
            <span id="busuanzi_page_pv" class="text-[var(--primary)] font-bold">åŠ è½½ä¸­...</span> æ¬¡ |
            ğŸ‘€æ€»è®¿é—®
            <span id="busuanzi_site_pv" class="text-[var(--primary)] font-bold">åŠ è½½ä¸­...</span> æ¬¡ |
            æ€»è®¿å®¢
            <span id="busuanzi_site_uv" class="text-[var(--primary)] font-bold">åŠ è½½ä¸­...</span> äºº
        </span>
        <br>

        <!-- ICP å¤‡æ¡ˆå· -->
        <a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer"
           class="text-[var(--primary)] font-bold">
            æ™‹ICPå¤‡2025063045å·
        </a>
        <br>

        <!-- è¿è¡Œæ—¶é—´æ˜¾ç¤º -->
        <div id="running-time-container">
            <span id="running-time-text">â±ï¸è¿è¡Œæ—¶é—´è®¡ç®—ä¸­...</span>
        </div>
    </div>

    <!-- ç‰ˆæƒ & é“¾æ¥ -->
    <div class="transition text-50 text-sm text-center mt-3 text-black/50 dark:text-white/50">
        &copy; <span id="copyright-year">{currentYear}</span> {profileConfig.name}. All Rights Reserved. /
        <a class="transition link text-[var(--primary)] font-medium" target="_blank" href={url('rss.xml')}>RSS</a> /
        <a class="transition link text-[var(--primary)] font-medium" target="_blank" href={url('sitemap-index.xml')}>Sitemap</a><br>
        Powered by
        <a class="transition link text-[var(--primary)] font-medium" target="_blank" href="https://astro.build">Astro</a> &
        <a class="transition link text-[var(--primary)] font-medium" target="_blank" href="https://github.com/saicaca/fuwari">Fuwari</a>
    </div>
</footer>

<!-- è¿è¡Œæ—¶é—´è„šæœ¬ -->
<script is:inline>
    // ç«™ç‚¹è¿è¡Œæ—¶é—´è®¡ç®—
    function updateRunTime() {
        const startDate = new Date(2025, 6, 22, 8, 0, 0); // 2025å¹´7æœˆ22æ—¥ 8:00:00
        const nowDate = new Date();
        const diff = nowDate - startDate;
        const seconds = Math.floor(diff / 1000);
        
        if (seconds < 0) {
            document.getElementById("running-time-text").textContent = "â±ï¸è¿è¡Œæ—¶é—´è®¡ç®—ä¸­...";
            return;
        }
        
        const days = Math.floor(seconds / 86400);
        const hours = Math.floor((seconds % 86400) / 3600);
        const minutes = Math.floor((seconds % 3600) / 60);
        const secs = seconds % 60;
        
        const timeString = `â±ï¸æœ¬ç«™å·²è¿è¡Œ: ${days}å¤©${hours}å°æ—¶${minutes}åˆ†${secs}ç§’ â˜ï¸`;
        document.getElementById("running-time-text").textContent = timeString;
    }
    
    // åˆå§‹åŒ–è¿è¡Œæ—¶é—´æ˜¾ç¤º
    function initRunTime() {
        // é˜²æ­¢é‡å¤åˆå§‹åŒ–
        if (window.hasRunTimeInitialized) return;
        window.hasRunTimeInitialized = true;
        
        // ç«‹å³æ›´æ–°ä¸€æ¬¡
        updateRunTime();
        
        // è®¾ç½®å®šæ—¶å™¨æ¯ç§’æ›´æ–°
        window.runTimeInterval = setInterval(updateRunTime, 1000);
    }
    
    // å¤šé‡ä¿éšœçš„åˆå§‹åŒ–æ–¹å¼
    if (typeof window !== 'undefined') {
        // DOMå°±ç»ªæ—¶åˆå§‹åŒ–
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initRunTime);
        } else {
            // DOMå·²ç»å°±ç»ª
            initRunTime();
        }
        
        // é¡µé¢åŠ è½½å®Œæˆæ—¶åˆå§‹åŒ–
        window.addEventListener('load', initRunTime);
        
        // å¤šä¸ªæ—¶é—´ç‚¹çš„fallback
        setTimeout(initRunTime, 100);
        setTimeout(initRunTime, 500);
        setTimeout(initRunTime, 1000);
        setTimeout(initRunTime, 3000);
        
        // é¡µé¢å¯è§æ€§å˜åŒ–æ—¶æ›´æ–°
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                initRunTime();
            }
        });
        
        // é¡µé¢æ˜¾ç¤º/éšè—æ—¶å¤„ç†ï¼ˆé’ˆå¯¹ç§»åŠ¨ç«¯æµè§ˆå™¨ï¼‰
        window.addEventListener('pageshow', initRunTime);
        window.addEventListener('pagehide', () => {
            if (window.runTimeInterval) {
                clearInterval(window.runTimeInterval);
                window.runTimeInterval = null;
            }
        });
    }
</script>