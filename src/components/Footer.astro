---
// Ensure these are correctly imported in your .astro file's frontmatter
import { profileConfig } from "../config";
import { url } from "../utils/url-utils";

const currentYear = new Date().getFullYear();
---
<!-- åˆ†éš”çº¿ -->
<div class="transition border-t border-black/10 dark:border-white/15 my-10 border-dashed mx-32"></div>

<!-- footer å†…å®¹ -->
<div class="transition border-dashed border-[oklch(85%_0.01_var(--hue))] dark:border-white/15 rounded-2xl mb-12 flex flex-col items-center justify-center px-6 bg-[var(--page-bg)]">
    <!-- ç«™ç‚¹ç»Ÿè®¡ -->
    <div class="framework-info text-sm text-center text-black/75 dark:text-white/75">
        <!-- æ–°ç‰ˆä¸è’œå­ -->
        <!-- Fix 2: Use https protocol -->
        <script is:inline src="https://www.busuanzi.cc/static/3.6.9/busuanzi.min.js" defer></script>

        <span>
            æœ¬"<span class="text-[var(--primary)] font-bold">é¡µé¢</span>"é˜…è¯»
            <span id="busuanzi_page_pv" class="text-[var(--primary)] font-bold">åŠ è½½ä¸­...</span> æ¬¡ |
            ğŸ‘€æ€»è®¿é—®
            <span id="busuanzi_site_pv" class="text-[var(--primary)] font-bold">åŠ è½½ä¸­...</span> æ¬¡ |
            æ€»è®¿å®¢
            <span id="busuanzi_site_uv" class="text-[var(--primary)] font-bold">åŠ è½½ä¸­...</span> äºº
        </span>
        <br>

        <!-- ICP å¤‡æ¡ˆå· -->
        <!-- Fix 3: Remove trailing spaces in href -->
        <a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer"
           class="text-[var(--primary)] font-bold">
            æ™‹ICPå¤‡2025063045å·
        </a>
        <br>

        <!-- è¿è¡Œæ—¶é—´ -->
        <script is:inline>
            function runtime() {
                // ä½¿ç”¨æ­£ç¡®çš„å»ºç«™æ—¥æœŸï¼š2025å¹´7æœˆ22æ—¥
                // æ³¨æ„ï¼šJavaScriptä¸­æœˆä»½æ˜¯0ç´¢å¼•çš„ (6 = July)
                const start = new Date(2025, 6, 22, 8, 0, 0); // 2025å¹´7æœˆ22æ—¥
                const now   = new Date();
                const diff  = now - start;
                const sec   = Math.floor(diff / 1e3);

                // å¤„ç†å¼€å§‹æ—¥æœŸå¯èƒ½åœ¨æœªæ¥çš„æƒ…å†µï¼ˆé”™è¯¯æ£€æŸ¥ï¼‰
                if (sec < 0) {
                     document.getElementById("runningtime").innerHTML = "â±ï¸è¿è¡Œæ—¶é—´è®¡ç®—ä¸­...";
                     return;
                }

                const day   = Math.floor(sec / 86400);
                const hour  = Math.floor((sec % 86400) / 3600);
                const min   = Math.floor((sec % 3600) / 60);
                const sec2  = sec % 60;

                const runningtimeElement = document.getElementById("runningtime");
                if (runningtimeElement) {
                    runningtimeElement.innerHTML =
                        `â±ï¸æœ¬ç«™å·²è¿è¡Œ: ${day}å¤©${hour}å°æ—¶${min}åˆ†${sec2}ç§’ â˜ï¸`;
                }
            }
            
            // æ›´åŠ å¼ºå¥çš„åˆå§‹åŒ–æ–¹å¼ï¼Œç¡®ä¿åœ¨å„ç§è®¾å¤‡ä¸Šéƒ½èƒ½æ­£å¸¸å·¥ä½œ
            function initRuntime() {
                // ç¡®ä¿DOMå…ƒç´ å­˜åœ¨å†æ‰§è¡Œ
                const runningtimeElement = document.getElementById("runningtime");
                if (runningtimeElement) {
                    runtime();
                    // åªè®¾ç½®ä¸€æ¬¡intervalï¼Œé¿å…é‡å¤
                    if (!window.runtimeInterval) {
                        window.runtimeInterval = setInterval(runtime, 1000);
                    }
                }
            }
            
            // é¡µé¢åŠ è½½å®Œæˆåç«‹å³æ‰§è¡Œä¸€æ¬¡
            if (typeof window !== 'undefined') {
                window.addEventListener('load', initRuntime);
                
                // DOMå†…å®¹åŠ è½½å®Œæˆåæ‰§è¡Œ
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', initRuntime);
                } else {
                    // DOMå·²ç»åŠ è½½å®Œæˆ
                    initRuntime();
                }
                
                // å…¼å®¹ç§»åŠ¨ç«¯æµè§ˆå™¨çš„é¢å¤–å¤„ç†
                document.addEventListener('visibilitychange', function() {
                    if (!document.hidden) {
                        initRuntime();
                    }
                });
                
                // é’ˆå¯¹iOS Safariçš„ç‰¹æ®Šå¤„ç†
                if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
                    document.addEventListener('pagehide', function() {
                        if (window.runtimeInterval) {
                            clearInterval(window.runtimeInterval);
                            window.runtimeInterval = null;
                        }
                    });
                    
                    document.addEventListener('pageshow', function() {
                        initRuntime();
                    });
                }
                
                // æ·»åŠ ç§»åŠ¨ç«¯ç‰¹æ®Šå¤„ç† - å¢åŠ å»¶è¿Ÿæ‰§è¡Œç¡®ä¿DOMæ¸²æŸ“å®Œæˆ
                if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                    // ç§»åŠ¨ç«¯è®¾å¤‡ä¸Šå¢åŠ é¢å¤–çš„å»¶è¿Ÿæ‰§è¡Œ
                    setTimeout(initRuntime, 500);
                    setTimeout(initRuntime, 2000);
                }
            }
            
            // æ·»åŠ ä¸€ä¸ªfallbackæœºåˆ¶ï¼Œç¡®ä¿åœ¨æç«¯æƒ…å†µä¸‹ä¹Ÿèƒ½æ‰§è¡Œ
            setTimeout(() => {
                if (document.getElementById("runningtime") && 
                    document.getElementById("runningtime").innerHTML.includes("è®¡ç®—ä¸­")) {
                    initRuntime();
                }
            }, 1000);
            
            // å¢åŠ ä¸€ä¸ªæ›´é•¿çš„fallbackæœºåˆ¶
            setTimeout(() => {
                if (document.getElementById("runningtime") && 
                    document.getElementById("runningtime").innerHTML.includes("è®¡ç®—ä¸­")) {
                    initRuntime();
                }
            }, 3000);
        </script>
        <p id="runningtime" class="text-black/75 dark:text-white/75">â±ï¸è¿è¡Œæ—¶é—´è®¡ç®—ä¸­...</p>
    </div>

    <!-- ç‰ˆæƒ & é“¾æ¥ -->
    <div class="transition text-50 text-sm text-center mt-3 text-black/50 dark:text-white/50">
        &copy; <span id="copyright-year">{currentYear}</span> {profileConfig.name}. All Rights Reserved. /
        <a class="transition link text-[var(--primary)] font-medium" target="_blank" href={url('rss.xml')}>RSS</a> /
        <a class="transition link text-[var(--primary)] font-medium" target="_blank" href={url('sitemap-index.xml')}>Sitemap</a><br>
        Powered by
        <!-- Fix 4: Remove trailing spaces in href -->
        <a class="transition link text-[var(--primary)] font-medium" target="_blank" href="https://astro.build">Astro</a> &
        <a class="transition link text-[var(--primary)] font-medium" target="_blank" href="https://github.com/saicaca/fuwari">Fuwari</a>
    </div>
</div>