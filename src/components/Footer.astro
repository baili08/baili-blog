---
import { profileConfig } from "../config";
import { url } from "../utils/url-utils";

const currentYear = new Date().getFullYear();
---

<!-- 分隔线 -->
<div class="transition border-t border-black/10 dark:border-white/15 my-10 border-dashed mx-32"></div>

<!-- footer 内容 -->
<footer class="transition border-dashed border-[oklch(85%_0.01_var(--hue))] dark:border-white/15 rounded-2xl mb-12 flex flex-col items-center justify-center px-6 bg-[var(--page-bg)]">
    <!-- 站点统计 -->
    <div class="framework-info text-sm text-center text-black/75 dark:text-white/75">
        <!-- 不蒜子统计 -->
        <script is:inline src="https://www.busuanzi.cc/static/3.6.9/busuanzi.min.js" defer></script>

        <span>
            本"<span class="text-[var(--primary)] font-bold">页面</span>"阅读
            <span id="busuanzi_page_pv" class="text-[var(--primary)] font-bold">加载中...</span> 次 |
            👀总访问
            <span id="busuanzi_site_pv" class="text-[var(--primary)] font-bold">加载中...</span> 次 |
            总访客
            <span id="busuanzi_site_uv" class="text-[var(--primary)] font-bold">加载中...</span> 人
        </span>
        <br>

        <!-- ICP 备案号 -->
        <a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer"
           class="text-[var(--primary)] font-bold">
            晋ICP备2025063045号
        </a>
        <br>

        <!-- 运行时间显示 -->
        <div id="running-time-container">
            <span id="running-time-text">⏱️运行时间计算中...</span>
        </div>
    </div>

    <!-- 版权 & 链接 -->
    <div class="transition text-50 text-sm text-center mt-3 text-black/50 dark:text-white/50">
        &copy; <span id="copyright-year">{currentYear}</span> {profileConfig.name}. All Rights Reserved. /
        <a class="transition link text-[var(--primary)] font-medium" target="_blank" href={url('rss.xml')}>RSS</a> /
        <a class="transition link text-[var(--primary)] font-medium" target="_blank" href={url('sitemap-index.xml')}>Sitemap</a><br>
        Powered by
        <a class="transition link text-[var(--primary)] font-medium" target="_blank" href="https://astro.build">Astro</a> &
        <a class="transition link text-[var(--primary)] font-medium" target="_blank" href="https://github.com/saicaca/fuwari">Fuwari</a>
    </div>
</footer>

<!-- 运行时间脚本 -->
<script is:inline>
    // 站点运行时间计算
    function updateRunTime() {
        const startDate = new Date(2025, 6, 22, 8, 0, 0); // 2025年7月22日 8:00:00
        const nowDate = new Date();
        const diff = nowDate - startDate;
        const seconds = Math.floor(diff / 1000);
        
        if (seconds < 0) {
            document.getElementById("running-time-text").textContent = "⏱️运行时间计算中...";
            return;
        }
        
        const days = Math.floor(seconds / 86400);
        const hours = Math.floor((seconds % 86400) / 3600);
        const minutes = Math.floor((seconds % 3600) / 60);
        const secs = seconds % 60;
        
        const timeString = `⏱️本站已运行: ${days}天${hours}小时${minutes}分${secs}秒 ☁️`;
        document.getElementById("running-time-text").textContent = timeString;
    }
    
    // 初始化运行时间显示
    function initRunTime() {
        // 防止重复初始化
        if (window.hasRunTimeInitialized) return;
        window.hasRunTimeInitialized = true;
        
        // 立即更新一次
        updateRunTime();
        
        // 设置定时器每秒更新
        window.runTimeInterval = setInterval(updateRunTime, 1000);
    }
    
    // 多重保障的初始化方式
    if (typeof window !== 'undefined') {
        // DOM就绪时初始化
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initRunTime);
        } else {
            // DOM已经就绪
            initRunTime();
        }
        
        // 页面加载完成时初始化
        window.addEventListener('load', initRunTime);
        
        // 多个时间点的fallback
        setTimeout(initRunTime, 100);
        setTimeout(initRunTime, 500);
        setTimeout(initRunTime, 1000);
        setTimeout(initRunTime, 3000);
        
        // 页面可见性变化时更新
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                initRunTime();
            }
        });
        
        // 页面显示/隐藏时处理（针对移动端浏览器）
        window.addEventListener('pageshow', initRunTime);
        window.addEventListener('pagehide', () => {
            if (window.runTimeInterval) {
                clearInterval(window.runTimeInterval);
                window.runTimeInterval = null;
            }
        });
    }
</script>