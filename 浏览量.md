把「二叉树树流」的 Umami 浏览量脚本搬进 Astro 的 Fuwari 主题，只需要三步：准备配置 → 写组件 → 在文章页插槽。下面给出最小可跑的实现方式，你可以直接复制粘贴。

────────────────
1. 新建配置文件

在 `src/config.ts`（或你放站点配置的地方）追加：

```ts
export const umamiConfig = {
  enable: true,
  baseUrl: 'https://umami.baili.cfd',   // 换成你自己的 Umami 域名
  shareId: 'JHgyur0RQiPiNSSY',      // 换成你自己的 shareId
  timezone: 'Asia/Shanghai',
}
```

────────────────
2. 新建组件 `src/components/PostViews.astro`

```astro
---
import { umamiConfig } from '@/config'

export interface Props {
  slug: string
}
const { slug } = Astro.props
---

{umamiConfig.enable && (
  <span id={`page-views-${slug}`} class="text-sm text-fg-deeper">
    加载中…
  </span>
)}

<script define:vars={{ umamiConfig, slug }}>
  (async () => {
    if (!umamiConfig.enable) return

    const display = document.getElementById(`page-views-${slug}`)
    if (!display) return

    try {
      // 1. 拿 token
      const shareRes = await fetch(
        `${umamiConfig.baseUrl}/api/share/${umamiConfig.shareId}`
      )
      if (!shareRes.ok) throw new Error('share')
      const { websiteId, token } = await shareRes.json()

      // 2. 拿统计
      const statsRes = await fetch(
        `${umamiConfig.baseUrl}/api/websites/${websiteId}/stats?` +
          new URLSearchParams({
            startAt: '0',
            endAt: Date.now().toString(),
            unit: 'hour',
            timezone: umamiConfig.timezone,
            url: `/posts/${slug}/`,
            compare: 'false',
          }),
        { headers: { 'x-umami-share-token': token } }
      )
      if (!statsRes.ok) throw new Error('stats')
      const { pageviews, visits } = await statsRes.json()

      display.textContent = `浏览量 ${pageviews?.value || 0} · 访问数 ${
        visits?.value || 0
      }`
    } catch {
      display.textContent = '统计不可用'
    }
  })()
</script>
```

────────────────
3. 在文章页插入组件

打开 `src/pages/posts/[...slug].astro`，找到渲染正文的位置（大约 90～110 行，不同版本略有差异），在你想出现浏览量的地方加一行：

```astro
---
import PostViews from '@components/PostViews.astro'
...
---

<!-- 举例：放在标题下方 -->
<h1 class="text-3xl font-bold">{entry.data.title}</h1>
<PostViews slug={entry.slug} />
```

保存后 `pnpm dev`，进任意文章即可看到数字。

如果控制台出现「CORS」或「404」报错，说明 Umami 域名 / shareId / 文章路径 没配对，按报错信息调即可。

这样就把「二叉树树流」完整搬到 Fuwari 了，无需改动路由或 SSR，100 % 前端实现。